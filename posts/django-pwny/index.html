<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>django-pwny :: psypherpunk</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Originally published at The Data Shed.
 Much as we might lament their continued use, passwords are an important part of modern life. A part that seems only to be increasing in ubiquity; as I sit here I can see at least half a dozen devices, from this laptop to my television, that each require an inordinate number of passwords to keep them from turning into little more than novelty paperweights."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://blog.psypherpunk.io/posts/django-pwny/" />


<link rel="stylesheet" href="/assets/style.css">
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Source+Code+Pro' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="/assets/style.css">




<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/img/favicon.png">


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="django-pwny :: psypherpunk — " />
<meta name="twitter:description" content="Originally published at The Data Shed.
 Much as we might lament their continued use, passwords are an important part of modern life. A part that seems only to be increasing in ubiquity; as I sit here I can see at least half a dozen devices, from this laptop to my television, that each require an inordinate number of passwords to keep them from turning into little more than novelty paperweights." />
<meta name="twitter:site" content="https://blog.psypherpunk.io/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image" content="https://blog.psypherpunk.io/img/default.jpg">


<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="django-pwny :: psypherpunk — ">
<meta property="og:description" content="Originally published at The Data Shed.
 Much as we might lament their continued use, passwords are an important part of modern life. A part that seems only to be increasing in ubiquity; as I sit here I can see at least half a dozen devices, from this laptop to my television, that each require an inordinate number of passwords to keep them from turning into little more than novelty paperweights." />
<meta property="og:url" content="https://blog.psypherpunk.io/posts/django-pwny/" />
<meta property="og:site_name" content="django-pwny" />
<meta property="og:image" content="https://blog.psypherpunk.io/img/default.jpg">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">
<meta property="article:section" content="python" />
<meta property="article:published_time" content="2018-08-29 22:28:56 &#43;0000 UTC" />







</head>
<body class="dark-theme">
<div class="container">
  <header class="header">
  <span class="header__inner">
    <a href="https://blog.psypherpunk.io/" style="text-decoration: none;">
  <div class="logo">
    
      <span class="logo__mark">></span>
      <span class="logo__text">psypherpunk</span>
      <span class="logo__cursor"></span>
    
  </div>
</a>

    <span class="header__right">
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


  <div class="content">
    
  <div class="post">
    <h2 class="post-title"><a href="https://blog.psypherpunk.io/posts/django-pwny/">django-pwny</a></h2>
    <div class="post-meta">
      <span class="post-date">
        2018-08-29
      </span>
      <span class="post-author"> </span>
    </div>

    
      <span class="post-tags">
        
          #<a href="https://blog.psypherpunk.io/tags/django">django</a>&nbsp;
        
          #<a href="https://blog.psypherpunk.io/tags/python">python</a>&nbsp;
        
          #<a href="https://blog.psypherpunk.io/tags/security">security</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      

<blockquote>
<p><em>Originally published at <a href="https://www.thedatashed.co.uk/2019/02/07/django-pwny/">The Data Shed</a>.</em></p>
</blockquote>

<p>Much as we might lament their continued use, passwords are an important part of modern life. A part that seems only to be increasing in ubiquity; as I sit here I can see at least half a dozen devices, from this laptop to my television, that each require an inordinate number of passwords to keep them from turning into little more than novelty paperweights.</p>

<p>So let&rsquo;s take an inexplicable foray into the fun we have managing our little <em>&ldquo;memorized secrets&rdquo;</em>&hellip;</p>

<h2 id="nist-national-institute-of-standards-and-technology">NIST: National Institute of Standards and Technology</h2>

<h3 id="nist-special-publication-800-63">NIST Special Publication 800-63</h3>

<p>I&rsquo;m sure that many are intimately familiar with <em>NIST Special Publication 800-63. Appendix A</em>, by Bill Burr. Well, if not the document itself then at least its consequences. Therein, amidst discussions of Claude Shannon&rsquo;s work on entropy in information systems, he outlined what effectively became the de facto best practices for password generation for over a decade, asking us to consider:</p>

<blockquote>
<ul>
<li><em>a minimum of 8 character passwords, selected by subscribers from an alphabet of 94 printable characters,</em></li>
<li><em>required subscribers to include at least one upper case letter, one lower case letter, one number and one special character, and;</em></li>
<li><em>Used a dictionary to prevent subscribers from including common words and prevented permutations of the username as a password.</em><br /></li>
</ul>
</blockquote>

<p>He recently had this to say on the subject:</p>

<blockquote>
<p><em>&ldquo;Much of what I did I now regret. It just drives people bananas and they don&rsquo;t pick good passwords no matter what you do.&rdquo;</em></p>
</blockquote>

<p>He&rsquo;s not wrong, is he.</p>

<h3 id="nist-special-publication-800-63b">NIST Special Publication 800-63B</h3>

<p>Released in June 2017, the latest NIST guidelines make some surprising (or perhaps not so surprising) changes. Certainly it&rsquo;s a significantly lengthier document, given the weight of the task at hand and there&rsquo;s a definite <em>formality</em> to the language this time around. Perhaps the biggest change is a more general recognition that passwords themselves aren&rsquo;t enough.</p>

<p>Some of the more significant things to note:</p>

<ul>
<li>Gone are the periodic password changes (<em>&ldquo;Verifiers SHOULD NOT require memorized secrets to be changed arbitrarily (e.g., periodically)&rdquo;</em>).</li>
<li>Gone is the convoluted alphanumeric-song-and-dance (<em>&ldquo;Verifiers SHOULD NOT impose other composition rules (e.g., requiring mixtures of different character types or prohibiting consecutively repeated characters) for memorized secrets&rdquo;</em>).</li>
</ul>

<p>Oh, and for all you sites that won&rsquo;t let me paste my password: <em>&ldquo;Verifiers SHOULD permit claimants to use &ldquo;paste&rdquo; functionality when entering a memorized secret&rdquo;</em>!</p>

<p>Most noteworthy of all (at least in the context of my writing this), there&rsquo;s this little nugget from section 5.1.1.2:</p>

<blockquote>
<p><em>When processing requests to establish and change memorized secrets, verifiers SHALL compare the prospective secrets against a list that contains values known to be commonly-used, expected, or compromised. For example, the list MAY include, but is not limited to:</em></p>

<ul>
<li><em>Passwords obtained from previous breach corpuses.</em></li>
<li><em>Dictionary words.</em></li>
<li><em>Repetitive or sequential characters (e.g. &lsquo;aaaaaa&rsquo;, &lsquo;1234abcd&rsquo;).</em></li>
<li><em>Context-specific words, such as the name of the service, the username, and derivatives thereof.</em></li>
</ul>
</blockquote>

<p>What&rsquo;s that? <em>&ldquo;Passwords obtained from previous breach corpuses&rdquo;</em> you say?</p>

<h2 id="have-i-been-pwned">&rsquo;;&ndash;have i been pwned?</h2>

<p>Launched in 2013, the site <a href="https://haveibeenpwned.com/"><em>Have I Been Pwned?</em></a> stores and processes data
acquired from <em>breaches</em>, typically when said data are exposed publicly or some attempt is made to profit therefrom, in some from the Web&rsquo;s more insidious locales. It&rsquo;s a matter the site&rsquo;s creator, Troy Hunt, can better <a href="https://haveibeenpwned.com/About">explain</a> but the part most interesting to this particular topic is the fact that it exposes an <a href="https://haveibeenpwned.com/API/v2">API</a>.</p>

<p>Specifically, the API allows us to send it a password and check whether it has appeared in a previous data breach, thus fulfilling the <em>&ldquo;previous breach corpuses&rdquo;</em> part of the NIST guidelines.</p>

<p>Obviously, sending your password across the Web to <em>any</em> third-party service is Not A Very Good Thing To Do™ and thankfully the API&rsquo;s design takes this into account: the password isn&rsquo;t sent directly, we instead send a cryptographic hash derived from the password. Nor do we send the entire hash, instead passing only the first five characters.</p>

<p>The data returned from the API comprise a list of matching hash suffixes and number of occurrences of that hash within the corpus.</p>

<h3 id="perhaps-a-demonstration">Perhaps a demonstration?</h3>

<p>Let&rsquo;s say we have a password, a truly terrible password that no one would ever use:</p>

<pre><code class="language-bash">$ BAD_PASSWORD=&quot;password&quot;
</code></pre>

<p>No one would ever be silly enough to use that, right? So, purely for demonstration purposes as <em>no one would ever have this password</em>, we calculate the SHA1:</p>

<pre><code class="language-bash">$ BAD_PASSWORD_HASH=$(
    echo -n ${BAD_PASSWORD} | \
        sha1sum | \
        cut -d ' ' -f1 | \
        tr '[:lower:]' '[:upper:]'
)
</code></pre>

<p>Now we have a cryptographic hash of a password that <em>no one would ever use &lsquo;cause that would be silly</em> and can send the first five characters to the the <em>Have I Been Pwned</em> API:</p>

<pre><code class="language-bash">$ curl &quot;https://api.pwnedpasswords.com/range/${BAD_PASSWORD_HASH:0:5}&quot;
003D68EB55068C33ACE09247EE4C639306B:3
012C192B2F16F82EA0EB9EF18D9D539B0DD:1
01330C689E5D64F660D6947A93AD634EF8F:1
0198748F3315F40B1A102BF18EEA0194CD9:1
01F9033B3C00C65DBFD6D1DC4D22918F5E9:2
0424DB98C7A0846D2C6C75E697092A0CC3E:5
047F229A81EE2747253F9897DA38946E241:1
04A37A676E312CC7C4D236C93FBD992AA3C:5
...
</code></pre>

<p>Well that&rsquo;s a lot of results, 511 in fact (at time of writing). Of course, that doesn&rsquo;t mean that our password is actually in that list—*because, of course, no one would ever use it*—but we can double-check by seeing if the suffix from our SHA1 is in the list:</p>

<pre><code class="language-bash">$ curl &quot;https://api.pwnedpasswords.com/range/${BAD_PASSWORD_HASH:0:5}&quot; | \
    grep ${BAD_PASSWORD_HASH:5:}
1E4C9B93F3F0682250B6CF8331B7EE68FD8:3645804
</code></pre>

<p>Oh. Oh dear. So <code>password</code> has been used as a password and found in no fewer than 3,645,804 known data breaches? Burr was right, <em>&ldquo;they don&rsquo;t pick good passwords no matter what you do&rdquo;</em>.</p>

<h2 id="django">Django</h2>

<p>To perhaps give a more practical demonstration of how this might be integrated into a functioning site, I&rsquo;m going to look to <a href="https://www.djangoproject.com/">Django</a>. Password validation was <a href="https://docs.djangoproject.com/en/1.9/topics/auth/passwords/#module-django.contrib.auth.password_validation">introduced in 1.9</a> and essentially comprises a list of *validators*—objects with a <code>validate()</code> method—into each of which is passed the incoming password.</p>

<p>Of course, passwords aren&rsquo;t stored so there are only two points at which you can do this:</p>

<ul>
<li>User registration, where potentially you can protect users from using at-risk passwords.</li>
<li>Login, at which point you can merely warn users about the potential risk.</li>
</ul>

<p>To perhaps put the escalating problem of password management into perspective, in version 1.9 (December 2015) Django&rsquo;s <code>CommonPasswordValidator</code> contained a list of 1,000 commonly-used passwords. By version 2.1 (August 2018) it had grown to 20,000.</p>

<h3 id="pwny-validators-haveibeenpwnedvalidator"><code>pwny.validators.HaveIBeenPwnedValidator</code></h3>

<p>Here&rsquo;s a quick implementation, hereby dubbed <code>django-pwny</code> (and hence the ridiculous title of this post):</p>

<pre><code class="language-python">class HaveIBeenPwnedValidator:

    def validate(self, password, user=None):
        sha1 = hashlib.sha1()
        sha1.update(password.encode())
        digest = sha1.hexdigest().upper()
        prefix = digest[:5]
        url = f&quot;https://api.pwnedpasswords.com/range/{prefix}&quot;
        r = requests.get(url, headers={&quot;User-Agent&quot;: &quot;django-pwny&quot;})
        for suffix_count in r.text.splitlines():
            suffix, count = suffix_count.split(&quot;:&quot;)
            if digest == f&quot;{prefix}{suffix}&quot;:
                raise ValidationError(
                    f&quot;Your password has been pwned {count} times!&quot;
                )

    def get_help_text(self):
        return (
            &quot;Your password should not appear in a list of compromised&quot;
            &quot;passwords.&quot;
        )
</code></pre>

<p>While I&rsquo;m sure there&rsquo;s room for improvement, added to the <code>settings.py</code> file, it should allow users to be alerted should their chosen password be a little too <em>common</em>:</p>

<pre><code class="language-python">AUTH_PASSWORD_VALIDATORS = [
    {
        &quot;NAME&quot;: &quot;pwny.validators.HaveIBeenPwnedValidator&quot;,
    },
]
</code></pre>

<p>So there it is: a way, in accordance with the latest NIST guidelines, to compare users&rsquo; passwords against a substantial list of known breaches. Quite whether this particular recommendation will see widespread adoption, we&rsquo;ll have to wait and see.</p>

<p>Shortly after I drafted this, GitHub decided to <a href="https://blog.github.com/2018-07-31-new-improvements-and-best-practices-for-account-security-and-recoverability/#enforcing-stronger-passwords">get in on the act</a>. While that&rsquo;s definitely a major voice in the industry following the guidelines, they&rsquo;re definitely in the minority.</p>

<h2 id="references">References</h2>

<ul>
<li><a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-63b.pdf">NIST Special Publication 800-63B</a></li>
<li><a href="https://csrc.nist.gov/CSRC/media/Publications/sp/800-63/ver-10/archive/2004-06-30/documents/sp800-63-v1-0.pdf">NIST Special Publication 800-63</a></li>
<li><em>Talk Python to Me</em>, <a href="https://talkpython.fm/episodes/show/136/secure-code-lessons-from-have-i-been-pwned">Episode 136</a>.</li>
</ul>

    </div>
    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h"></span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="https://blog.psypherpunk.io/posts/go-down-the-rabbit-hole/">
                <span class="button__icon">←</span>
                <span class="button__text">Go Down the Rabbit Hole</span>
              </a>
            </span>
          
          
            <span class="button next">
              <a href="https://blog.psypherpunk.io/posts/hello-world/">
                <span class="button__text">Hello, World!</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    
  </div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">© 2019 PsypherPunk</div>
    
  </div>
</footer>


  <script src="/assets/main.js"></script>

  <script src="/assets/prism.js"></script>



  
</div>

</body>
</html>
